<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Besh Super Admin</title>
    
    <!-- Icons & Fonts -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #5856D6; /* Purple Theme */
            --bg-body: #F3F4F6;
            --bg-sidebar: #5856D6;
            --text-sidebar: #E0E7FF;
            --card-bg: #FFFFFF;
            --radius: 12px;
        }

        * { box-sizing: border-box; }
        body { margin: 0; font-family: 'Poppins', sans-serif; background: var(--bg-body); display: flex; height: 100vh; overflow: hidden; }

        /* SIDEBAR */
        .sidebar { width: 260px; background: var(--bg-sidebar); color: white; padding: 20px; display: flex; flex-direction: column; }
        .sidebar h2 { margin: 0 0 30px 0; font-size: 22px; text-align: center; }
        
        .nav-item { padding: 12px 15px; margin-bottom: 8px; border-radius: 10px; cursor: pointer; display: flex; align-items: center; gap: 12px; color: var(--text-sidebar); transition: 0.2s; }
        .nav-item:hover, .nav-item.active { background: rgba(255,255,255,0.2); color: white; font-weight: 600; }
        .nav-item i { width: 20px; text-align: center; }

        /* MAIN CONTENT */
        .main-content { flex: 1; padding: 30px; overflow-y: auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        
        /* AUTH BOX */
        .auth-box { background: #EEF2FF; border: 1px solid #C7D2FE; padding: 20px; border-radius: var(--radius); margin-bottom: 30px; }
        .auth-box input { width: 100%; padding: 12px; border: 1px solid #D1D5DB; border-radius: 8px; margin-top: 5px; outline: none; }

        /* SECTIONS */
        .section { display: none; animation: fadeIn 0.3s; }
        .section.active { display: block; }
        @keyframes fadeIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }

        /* CARDS */
        .card { background: var(--card-bg); padding: 25px; border-radius: var(--radius); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .card h3 { margin-top: 0; margin-bottom: 20px; color: #1F2937; }

        /* DASHBOARD STATS */
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .stat-card { background: #F9FAFB; padding: 20px; border-radius: var(--radius); text-align: center; border: 1px solid #E5E7EB; }
        .stat-val { font-size: 24px; font-weight: 700; color: var(--primary); margin: 10px 0; }
        
        /* FORMS */
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; font-size: 13px; font-weight: 600; color: #4B5563; margin-bottom: 6px; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 12px; border: 1px solid #D1D5DB; border-radius: 8px; font-family: inherit; outline: none; transition: border 0.2s; }
        .form-group input:focus { border-color: var(--primary); }

        .row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }

        /* BUTTONS */
        .btn { padding: 12px 24px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; color: white; transition: 0.2s; }
        .btn-primary { background: #10B981; width: 100%; } /* Green */
        .btn-primary:hover { background: #059669; }
        
        .btn-blue { background: var(--primary); }
        .btn-danger { background: #EF4444; }
        .btn-sm { padding: 8px 16px; font-size: 13px; }

        /* TABLES & LISTS */
        .list-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #F9FAFB; border-radius: 8px; margin-bottom: 10px; border: 1px solid #E5E7EB; }
    </style>
</head>
<body>

    <!-- SIDEBAR -->
    <div class="sidebar">
        <h2>Admin Panel</h2>
        <div class="nav-item active" onclick="nav('dashboard')"><i class="fa-solid fa-chart-line"></i> Dashboard</div>
        <div class="nav-item" onclick="nav('config')"><i class="fa-solid fa-sliders"></i> Configuration</div>
        <div class="nav-item" onclick="nav('users')"><i class="fa-solid fa-users"></i> Users</div>
        <div class="nav-item" onclick="nav('tasks')"><i class="fa-solid fa-list-check"></i> Tasks</div>
        <div class="nav-item" onclick="nav('withdrawals')"><i class="fa-solid fa-money-bill-transfer"></i> Withdrawals</div>
        <div class="nav-item" onclick="nav('broadcast')"><i class="fa-solid fa-bullhorn"></i> Broadcast</div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="main-content">
        
        <!-- GLOBAL PASSWORD -->
        <div class="auth-box">
            <label>ðŸ”‘ Admin Password</label>
            <input type="password" id="password" placeholder="Enter password to save/edit..." value="123">
        </div>

        <!-- 1. DASHBOARD -->
        <div id="dashboard" class="section active">
            <div class="card">
                <h3>Overview</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div>Total Users</div>
                        <div class="stat-val" id="total-users">-</div>
                    </div>
                    <div class="stat-card">
                        <div>Pending Requests</div>
                        <div class="stat-val" id="pending-req">-</div>
                    </div>
                    <div class="stat-card">
                        <div>Total Payout</div>
                        <div class="stat-val" id="total-paid">-</div>
                    </div>
                </div>
                <button class="btn btn-blue" onclick="loadStats()" style="margin-top:20px;">Refresh Stats</button>
            </div>
        </div>

        <!-- 2. CONFIGURATION -->
        <div id="config" class="section">
            <div class="card">
                <h3>Core Configuration</h3>
                
                <div class="row">
                    <div class="form-group">
                        <label>Currency Name</label>
                        <input id="currencyName" value="Birr">
                    </div>
                    <div class="form-group">
                        <label>Min Withdraw</label>
                        <input id="minWithdraw" type="number" value="10">
                    </div>
                </div>

                <div class="row">
                    <div class="form-group">
                        <label>Ads Per Day</label>
                        <input id="dailyLimit" type="number" value="25">
                    </div>
                    <div class="form-group">
                        <label>Reward per Ad</label>
                        <input id="adReward" type="number" value="5">
                    </div>
                </div>

                <div class="row">
                    <div class="form-group">
                        <label>Referrer Bonus</label>
                        <input id="refBonus" type="number" value="25">
                    </div>
                    <div class="form-group">
                        <label>Req Invites (to Withdraw)</label>
                        <input id="minInvites" type="number" value="1">
                    </div>
                </div>

                <div class="form-group">
                    <label>Admin Chat ID</label>
                    <input id="adminId" value="6941014837">
                </div>

                <div class="form-group">
                    <label>Bot Link</label>
                    <input id="botLink" value="https://t.me/Beshbesh_Bot">
                </div>

                <div class="form-group">
                    <label>Mini App URL</label>
                    <input id="appUrl" value="https://besh.onrender.com">
                </div>

                <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">
                <h3>Text & Messages</h3>

                <div class="form-group">
                    <label>Welcome Message</label>
                    <textarea id="welcomeText" rows="4">Hi {name}! Welcome to Besh Besh.</textarea>
                </div>

                <div class="form-group">
                    <label>Share Text (Invite)</label>
                    <textarea id="shareText" rows="2">Join Besh Besh and earn 25 Birr!</textarea>
                </div>

                <div class="row">
                    <div class="form-group">
                        <label>Welcome Image URL</label>
                        <input id="welcomeImg">
                    </div>
                    <div class="form-group">
                        <label>Button Text</label>
                        <input id="btnText" value="ðŸš€ Open App">
                    </div>
                </div>

                <button class="btn btn-primary" onclick="saveConfig()">Save Settings</button>
            </div>
        </div>

        <!-- 3. USERS -->
        <div id="users" class="section">
            <div class="card">
                <h3>User Management</h3>
                <div class="form-group" style="display:flex; gap:10px;">
                    <input id="search-id" placeholder="Enter User ID">
                    <button class="btn btn-blue" onclick="searchUser()">Search</button>
                </div>
                <div id="user-result" style="margin-top:20px;"></div>
            </div>
        </div>

        <!-- 4. TASKS -->
        <div id="tasks" class="section">
            <div class="card">
                <h3>Manage Tasks</h3>
                <div class="form-group">
                    <label>Task Name</label>
                    <input id="t-name">
                </div>
                <div class="form-group">
                    <label>Reward</label>
                    <input id="t-reward" type="number">
                </div>
                <div class="form-group">
                    <label>Link / Channel</label>
                    <input id="t-link">
                </div>
                <button class="btn btn-primary" onclick="addTask()">Add Task</button>
            </div>

            <div class="card">
                <h3>Existing Tasks</h3>
                <div id="task-list">
                    <!-- Tasks Loaded Here -->
                </div>
            </div>
        </div>

        <!-- 5. WITHDRAWALS -->
        <div id="withdrawals" class="section">
            <div class="card">
                <h3>Pending Withdrawals</h3>
                <button class="btn btn-blue" onclick="loadWithdrawals()">Load</button>
                <div id="withdrawal-list" style="margin-top:20px;"></div>
            </div>
        </div>

        <!-- 6. BROADCAST -->
        <div id="broadcast" class="section">
            <div class="card">
                <h3>ðŸ“¢ Broadcast</h3>
                
                <div class="form-group">
                    <label>Target</label>
                    <select id="bc-target">
                        <option value="all">All Users</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Message</label>
                    <textarea id="bc-msg" rows="4"></textarea>
                </div>

                <div class="form-group">
                    <label>Image URL (Optional)</label>
                    <input id="bc-img">
                </div>

                <div class="row">
                    <div class="form-group">
                        <label>Btn Text</label>
                        <input id="bc-btn-txt">
                    </div>
                    <div class="form-group">
                        <label>Btn Link</label>
                        <input id="bc-btn-link">
                    </div>
                </div>

                <button class="btn btn-primary" onclick="sendBroadcast()">Send</button>
            </div>
        </div>

    </div>

    <script>
        const API = '/api/bot';

        // Navigation
        function nav(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            event.currentTarget.classList.add('active');
        }

        function getPass() { return document.getElementById('password').value; }

        // --- API CALLS ---

        async function loadStats() {
            // Placeholder: Fetch stats from DB
            document.getElementById('total-users').innerText = '1,204';
            document.getElementById('pending-req').innerText = '5';
            document.getElementById('total-paid').innerText = '4,500 Br';
        }

        async function saveConfig() {
            const data = {
                currency: document.getElementById('currencyName').value,
                minWithdraw: parseFloat(document.getElementById('minWithdraw').value),
                dailyLimit: parseInt(document.getElementById('dailyLimit').value),
                adReward: parseFloat(document.getElementById('adReward').value),
                refBonus: parseFloat(document.getElementById('refBonus').value),
                minInvites: parseInt(document.getElementById('minInvites').value),
                adminId: document.getElementById('adminId').value,
                botLink: document.getElementById('botLink').value,
                appUrl: document.getElementById('appUrl').value,
                welcomeText: document.getElementById('welcomeText').value,
                shareText: document.getElementById('shareText').value,
                welcomeImg: document.getElementById('welcomeImg').value,
                btnText: document.getElementById('btnText').value
            };

            const res = await fetch(API, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ action: 'admin_action', type: 'save_settings', password: getPass(), data })
            });
            alert((await res.json()).success ? "Settings Saved!" : "Error/Wrong Password");
        }

        async function addTask() {
            const task = {
                id: 't' + Date.now(),
                title: document.getElementById('t-name').value,
                reward: parseFloat(document.getElementById('t-reward').value),
                link: document.getElementById('t-link').value
            };
            // Save to DB (Implement backend logic)
            alert("Task Added (Frontend Only - Connect Backend)");
            renderTask(task);
        }

        function renderTask(t) {
            const div = document.createElement('div');
            div.className = 'list-item';
            div.innerHTML = `
                <div><b>${t.title}</b> (${t.reward})</div>
                <div>
                    <button class="btn btn-sm" style="background:#FBBF24; color:black;">Edit</button>
                    <button class="btn btn-sm btn-danger">Del</button>
                </div>
            `;
            document.getElementById('task-list').appendChild(div);
        }

        async function sendBroadcast() {
            if(!confirm("Send to all users?")) return;
            const res = await fetch(API, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    action: 'admin_action', 
                    type: 'broadcast', 
                    password: getPass(),
                    message: document.getElementById('bc-msg').value,
                    image: document.getElementById('bc-img').value,
                    btnText: document.getElementById('bc-btn-txt').value,
                    btnLink: document.getElementById('bc-btn-link').value
                })
            });
            alert("Broadcast Sent!");
        }

        // Init
        loadStats();
    </script>
</body>
</html>